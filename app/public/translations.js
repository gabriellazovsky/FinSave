const translations = {
    es: {
        welcome: "Bienvenido, ",
        profile: "Perfil",
        logout: "Cerrar sesión",
        email: "Correo",
        memberSince: "Miembro desde",
        save: "Guardar",
        editProfile: "Editar perfil",
        settings: "Configuración",
        language: "Idioma",
        currency: "Moneda",
        userProfile: "Perfil del Usuario",
        name: "Nombre",
        balance: "Balance",
        theme: "Tema",
        light: "Claro",
        dark: "Oscuro",
        saveChanges: "Guardar Cambios",
        profileSettings: "Ajustes",
        spanish: "Español",
        english: "Inglés",
        back: "← Volver",
        home: "Inicio",
        // CONVERSOR
        converter: "Conversor",
        convertCurrency: "Convertir Moneda",
        currencies: "Monedas",
        from: "Desde",
        to: "Hacia",
        rate: "Tasa",
        approximateRate: "Tasa aproximada",
        ratesInfo: "Tasas en tiempo real vía exchangerate.host",
        offlineCalc: "Cálculo aproximado sin conexión",
        history: "Historial",
        noHistory: "Sin historial",
        clearHistory: "Limpiar historial",
        online: "Online",
        offline: "Sin conexión",
        amount: "Cantidad",
        convert: "Convertir",
        // FEEDBACK
        feedbackHistory: "Historial de Feedbacks",
        themeToggle: "Light / Dark Mode",
        feedbackTitle: "Tu Comentario es Importante",
        comment: "Comentario:",
        writeFeedback: "Escribe tu feedback aquí...",
        feedbackType: "Tipo de Feedback:",
        selectType: "Selecciona un tipo",
        suggestion: "Sugerencia",
        bugReport: "Reporte de Error",
        general: "General",
        sendFeedback: "Enviar Feedback",
        // FAQ
        helpCenter: "Centro de Ayuda",
        faqTitle: "Preguntas Frecuentes",
        faqSubtitle: "Encuentra respuestas rápidas sobre tu cuenta, seguridad y uso de la plataforma.",
        accountAccess: "Cuenta y Acceso",
        mainPage: "Página Principal",
        additionalFeatures: "Funciones Adicionales",
        stillQuestions: "¿Aún tienes dudas? Escríbenos a",
        // PREGUNTAS FAQ
        faq1Question: "Olvidé mi contraseña, ¿qué hago?",
        faq1Answer: "En la pantalla de inicio de sesión encontrarás la opción '¿Olvidaste tu contraseña?'. Desde allí podrás restablecerla de forma segura.",
        faq2Question: "¿Para qué sirve colocar un nombre al iniciar sesión?",
        faq2Answer: "Es únicamente para personalizar tu experiencia y referirnos a ti como prefieras.",
        faq3Question: "¿Cómo cierro sesión?",
        faq3Answer: "Desde el inicio, presiona el botón 'Cerrar Sesión'. Te recomendamos hacerlo siempre por seguridad.",
        faq4Question: "¿Cómo hago un ingreso?",
        faq4Answer: "Pulsa el botón verde debajo de la gráfica principal. La operación quedará registrada automáticamente.",
        faq5Question: "¿Cómo filtro mis movimientos?",
        faq5Answer: "Usa el botón gris sobre la tabla para filtrar por tipo o cantidad.",
        faq6Question: "¿Qué es la bola azul en pantalla?",
        faq6Answer: "Es FinMuru, nuestra adorable mascota. Un día apareció… y se quedó para siempre.",
        faq7Question: "¿Qué son los logros?",
        faq7Answer: "Un sistema para gamificar el ahorro y motivarte con pequeños objetivos y recompensas visuales.",
        faq8Question: "¿Para qué sirve el feedback?",
        faq8Answer: "Es la forma más rápida de enviarnos sugerencias o reportar detalles para mejorar tu experiencia.",
        // DASHBOARD
        professionalDashboard: "Dashboard Profesional",
        exportPDF: "Exportar PDF",
        deleteAll: "Eliminar Todo",
        widgets: "Widgets",
        lineChart: "Gráfico Lineal",
        barChart: "Gráfico de Barras",
        pieChart: "Gráfico Circular",
        table: "Tabla",
        text: "Texto",
        kpi: "KPI",
        chart: "Gráfico",
        chartData: "10,20,30",
        chartLabels: "Ene,Feb,Mar",
        search: "Buscar...",
        client: "Cliente",
        balance: "Saldo",
        john: "Juan",
        addRow: "Agregar fila",
        notes: "Notas",
        writeNotes: "Escribe tus notas...",
        new: "Nuevo",

        // CONSEJOS - NUEVAS TRADUCCIONES
        "helpCenter": "Centro Educativo",
        "categories.saving": "Ahorro",
        "categories.investment": "Inversión",
        "categories.budget": "Presupuesto",
        "categories.other": "Otros",
        "personalized": "Personalizado",
        "personalizedRecommendations": "Recomendaciones Personalizadas",
        "noRecommendations": "No hay recomendaciones disponibles",
        "noContent": "No hay contenido en esta categoría aún",
        "allRightsReserved": "Todos los derechos reservados",
        "clickForMore": "Haz click aquí para saber más",
        "seeMore": "Ver más",

        // historialfeedback
"feedbackHistory": "Historial de Feedbacks",
"loading.historial": "Cargando historial...",
"feedback.feedback_type": "Tipo de Feedback", 
"feedback.message": "Mensaje",
        "feedback.no_feedbacks": "No hay feedbacks enviados aún",

        // CONTENIDO DE ARTÍCULOS - NUEVAS TRADUCCIONES
        "article.5WaysSave": "5 formas reales de ahorrar cada mes",
        "article.5WaysSaveText": "1. Automatiza tus ahorros\n2. Reduce gastos innecesarios\n3. Compra con lista\n4. Evita deudas costosas\n5. Revisa tus suscripciones",

        "link.savers": "Ahorradoras",
        "link.saversDesc": "Portal de ahorro y comunidad educativa.",

        "podcast.dailyFinance": "Al día en finanzas",
        "podcast.dailyFinanceDesc": "Podcast de EFPA España sobre finanzas actuales.",

        "article.investSavings": "Invertir mis Ahorros",
        "article.investSavingsText": "Comienza diversificando, invierte a largo plazo y evita decisiones impulsivas.",

        "video.investGuide": "Guía para empezar a invertir",
        "video.investGuideDesc": "Tutorial en vídeo para principiantes.",

        "link.financeEFE": "Finanzas con EFE",
        "link.financeEFEDesc": "Podcast educativo por EFE y CaixaBank.",

        "article.budgetOrganization": "Cómo organizar tu presupuesto mensual",
        "article.budgetOrganizationText": "1. Calcula tus ingresos\n2. Lista tus gastos\n3. Prioriza necesidades\n4. Asigna ahorro\n5. Revisa mensualmente",

        // INTERNACIONALIZACIÓN
        "app.title": "FinSave",
        "app.name": "FinSave",
        "login.subtitle": "Administra tus finanzas fácilmente",
        "login.tab": "Login",
        "login.email_placeholder": "Correo",
        "login.password_placeholder": "Contraseña",
        "login.forgot_password": "¿Olvidaste tu contraseña?",
        "login.submit_button": "Entrar",
        "register.tab": "Registro",
        "register.name_placeholder": "Nombre",
        "register.email_placeholder": "Correo",
        "register.password_placeholder": "Contraseña",
        "register.submit_button": "Registrarse",
        "nav.company": "Empresa",
        "nav.personal": "Persona",
        "nav.advice": "Consejo",
        "nav.adpersonal": "Consejos Personalizados",
        "nav.faq": "FAQ",
        "nav.achievements": "Logros",
        "nav.contact": "Contáctanos",
        "nav.converter": "Conversor",
        "nav.change_account": "Cambiar cuenta",
        "nav.logout": "Cerrar Sesión",
        "theme.toggle_title": "Activa modo oscuro/claro",
        "theme.toggle_label": "Light / Dark Mode",
        "dropdown.app_name": "FinSave",
        "dropdown.profile": "Perfil",
        "dropdown.logout": "Cerrar sesión",
        "actions.add_movement": "Insertar movimiento",
        "actions.export_csv": "Exportar CSV",
        "converter.title": "Conversor EUR → USD",
        "converter.amount_label": "Cantidad en euros:",
        "converter.amount_placeholder": "Ej: 50",
        "converter.convert_button": "Convertir",
        "filters.filter_table": "Filtrar tabla",
        "filters.view_history": "Ver Historial",
        "filters.amount": "Monto:",
        "filters.default": "predeterminado",
        "filters.price": "Precio:",
        "filters.min_placeholder": "min",
        "filters.max_placeholder": "max",
        "filters.apply_button": "Aplicar Filtros",
        "filters.clear_button": "Limpiar Filtros",
        "edit.title": "Editar Movimiento",
        "edit.type_placeholder": "Tipo",
        "edit.amount_placeholder": "Monto",
        "edit.description_placeholder": "Descripción",
        "edit.save_button": "Guardar",
        "edit.cancel_button": "Cancelar",
        "categories.leisure": "Ocio",
        "categories.food": "Comida",
        "categories.rent": "Alquiler",
        "categories.payroll": "Nómina",
        "categories.gasoline": "Gasolina",
        "table.type": "Tipo",
        "table.amount": "Monto",
        "table.date": "Fecha",
        "table.description": "Descripción",
        "table.actions": "Acciones",
        "movement.title": "Nuevo Movimiento",
        "movement.title_placeholder": "Título",
        "movement.amount_placeholder": "Monto",
        "movement.income": "Ingreso",
        "movement.expense": "Gasto",
        "movement.save_button": "Guardar",
        "achievements.back": "← Volver",
        "achievements.title": "Logros",
        "achievements.system_title": "Sistema de Logros",
        "achievements.subtitle": "Tu progreso en la gestión financiera",
        "achievements.table_achievement": "Logro",
        "achievements.table_status": "Estado",
        "achievements.save_100": "Ahorrar 100€",
        "achievements.save_500": "Ahorrar 500€",
        "achievements.record_10": "Registrar 10 movimientos",
        "achievements.record_50": "Registrar 50 movimientos",
        "achievements.first_expense": "Primer gasto registrado",
        "achievements.first_income": "Primer ingreso registrado",
        "achievements.save_1000": "Ahorrar 1000€",
        "achievements.food_under_50": "Gasto en comida < 50€ en un mes",
        "achievements.three_months_saving": "3 meses consecutivos de ahorro",
        "achievements.export_csv": "Exportar tu historial a CSV",
        "achievements.pending": "Pendiente",
        "achievements.overall_progress": "Progreso General",
        "achievements.reset_button": "Reiniciar Logros",
        "market.open_panel": "Abrir panel de Mercado",
        "market.title": "Precios en Vivo",
        "market.symbols_placeholder": "Símbolos (separados por comas), ej: AAPL,MSFT,SPY",
        "market.subscribe_button": "Suscribir",
        "market.unsubscribe_all": "Cancelar todas las suscripciones",
        "common.close": "Cerrar"
    },
    en: {
        welcome: "Welcome, ",
        profile: "Profile",
        logout: "Sign Out",
        email: "Email",
        memberSince: "Member since",
        save: "Save",
        editProfile: "Edit profile",
        settings: "Settings",
        language: "Language",
        currency: "Currency",
        userProfile: "User Profile",
        name: "Name",
        balance: "Balance",
        theme: "Theme",
        light: "Light",
        dark: "Dark",
        saveChanges: "Save Changes",
        profileSettings: "Settings",
        spanish: "Spanish",
        english: "English",
        back: "← Back",
        home: "Home",
        // CONVERTER
        converter: "Converter",
        convertCurrency: "Convert Currency",
        currencies: "Currencies",
        from: "From",
        to: "To",
        rate: "Rate",
        approximateRate: "Approximate rate",
        ratesInfo: "Real-time rates via exchangerate.host",
        offlineCalc: "Approximate calculation offline",
        history: "History",
        noHistory: "No history",
        clearHistory: "Clear history",
        online: "Online",
        offline: "Offline",
        amount: "Amount",
        convert: "Convert",
        // FEEDBACK
        feedbackHistory: "Feedback History",
        themeToggle: "Light / Dark Mode",
        feedbackTitle: "Your Feedback Matters",
        comment: "Comment:",
        writeFeedback: "Write your feedback here...",
        feedbackType: "Feedback Type:",
        selectType: "Select a type",
        suggestion: "Suggestion",
        bugReport: "Bug Report",
        general: "General",
        sendFeedback: "Send Feedback",
        // FAQ
        helpCenter: "Help Center",
        faqTitle: "Frequently Asked Questions",
        faqSubtitle: "Find quick answers about your account, security, and platform usage.",
        accountAccess: "Account and Access",
        mainPage: "Main Page",
        additionalFeatures: "Additional Features",
        stillQuestions: "Still have questions? Email us at",
        // FAQ QUESTIONS
        faq1Question: "I forgot my password, what should I do?",
        faq1Answer: "On the login screen you'll find the 'Forgot your password?' option. From there you can securely reset it.",
        faq2Question: "What's the purpose of entering a name when logging in?",
        faq2Answer: "It's only to personalize your experience and address you as you prefer.",
        faq3Question: "How do I sign out?",
        faq3Answer: "From the main page, press the 'Sign Out' button. We recommend doing this always for security.",
        faq4Question: "How do I make a deposit?",
        faq4Answer: "Press the green button below the main chart. The transaction will be automatically recorded.",
        faq5Question: "How do I filter my transactions?",
        faq5Answer: "Use the gray button above the table to filter by type or amount.",
        faq6Question: "What is the blue ball on the screen?",
        faq6Answer: "That's FinMuru, our adorable mascot. One day it appeared... and stayed forever.",
        faq7Question: "What are achievements?",
        faq7Answer: "A system to gamify saving and motivate you with small goals and visual rewards.",
        faq8Question: "What is feedback for?",
        faq8Answer: "It's the fastest way to send us suggestions or report details to improve your experience.",
        // DASHBOARD
        professionalDashboard: "Professional Dashboard",
        exportPDF: "Export PDF",
        deleteAll: "Delete All",
        widgets: "Widgets",
        lineChart: "Line Chart",
        barChart: "Bar Chart",
        pieChart: "Pie Chart",
        table: "Table",
        text: "Text",
        kpi: "KPI",
        chart: "Chart",
        chartData: "10,20,30",
        chartLabels: "Jan,Feb,Mar",
        search: "Search...",
        client: "Client",
        balance: "Balance",
        john: "John",
        addRow: "Add row",
        notes: "Notes",
        writeNotes: "Write your notes...",
        new: "New",

        // CONSEJOS - NUEVAS TRADUCCIONES
        "helpCenter": "Educational Center",
        "categories.saving": "Saving",
        "categories.investment": "Investment",
        "categories.budget": "Budget",
        "categories.other": "Other",
        "personalized": "Personalized",
        "personalizedRecommendations": "Personalized Recommendations",
        "noRecommendations": "No recommendations available",
        "noContent": "No content in this category yet",
        "allRightsReserved": "All rights reserved",
        "clickForMore": "Click here to learn more",
        "seeMore": "See more",

          // historialfeedback
"feedbackHistory": "Feedback History",
"loading.historial": "Loading history...",
"feedback.feedback_type": "Feedback Type",
"feedback.message": "Message",
          "feedback.no_feedbacks": "No feedbacks sent yet",


        // CONTENIDO DE ARTÍCULOS - NUEVAS TRADUCCIONES
        "article.5WaysSave": "5 real ways to save every month",
        "article.5WaysSaveText": "1. Automate your savings\n2. Reduce unnecessary expenses\n3. Shop with a list\n4. Avoid costly debts\n5. Review your subscriptions",

        "link.savers": "Savers",
        "link.saversDesc": "Savings portal and educational community.",

        "podcast.dailyFinance": "Daily Finance",
        "podcast.dailyFinanceDesc": "EFPA Spain podcast on current finances.",

        "article.investSavings": "Investing my Savings",
        "article.investSavingsText": "Start by diversifying, invest long-term and avoid impulsive decisions.",

        "video.investGuide": "Guide to start investing",
        "video.investGuideDesc": "Video tutorial for beginners.",

        "link.financeEFE": "Finance with EFE",
        "link.financeEFEDesc": "Educational podcast by EFE and CaixaBank.",

        "article.budgetOrganization": "How to organize your monthly budget",
        "article.budgetOrganizationText": "1. Calculate your income\n2. List your expenses\n3. Prioritize needs\n4. Allocate savings\n5. Review monthly",

        // INTERNATIONALIZATION
        "app.title": "FinSave",
        "app.name": "FinSave",
        "login.subtitle": "Manage your finances easily",
        "login.tab": "Login",
        "login.email_placeholder": "Email",
        "login.password_placeholder": "Password",
        "login.forgot_password": "Forgot your password?",
        "login.submit_button": "Enter",
        "register.tab": "Register",
        "register.name_placeholder": "Name",
        "register.email_placeholder": "Email",
        "register.password_placeholder": "Password",
        "register.submit_button": "Sign Up",
        "nav.company": "Company",
        "nav.personal": "Personal",
        "nav.advice": "Advice",
        "nav.adpersonal": "Personalized Advice",
        "nav.faq": "FAQ",
        "nav.achievements": "Achievements",
        "nav.contact": "Contact Us",
        "nav.converter": "Converter",
        "nav.change_account": "Change Account",
        "nav.logout": "Sign Out",
        "theme.toggle_title": "Toggle dark/light mode",
        "theme.toggle_label": "Light / Dark Mode",
        "dropdown.app_name": "FinSave",
        "dropdown.profile": "Profile",
        "dropdown.logout": "Sign Out",
        "actions.add_movement": "Add Movement",
        "actions.export_csv": "Export CSV",
        "converter.title": "EUR → USD Converter",
        "converter.amount_label": "Amount in euros:",
        "converter.amount_placeholder": "e.g.: 50",
        "converter.convert_button": "Convert",
        "filters.filter_table": "Filter Table",
        "filters.view_history": "View History",
        "filters.amount": "Amount:",
        "filters.default": "default",
        "filters.price": "Price:",
        "filters.min_placeholder": "min",
        "filters.max_placeholder": "max",
        "filters.apply_button": "Apply Filters",
        "filters.clear_button": "Clear Filters",
        "edit.title": "Edit Movement",
        "edit.type_placeholder": "Type",
        "edit.amount_placeholder": "Amount",
        "edit.description_placeholder": "Description",
        "edit.save_button": "Save",
        "edit.cancel_button": "Cancel",
        "categories.leisure": "Leisure",
        "categories.food": "Food",
        "categories.rent": "Rent",
        "categories.payroll": "Payroll",
        "categories.gasoline": "Gasoline",
        "table.type": "Type",
        "table.amount": "Amount",
        "table.date": "Date",
        "table.description": "Description",
        "table.actions": "Actions",
        "movement.title": "New Movement",
        "movement.title_placeholder": "Title",
        "movement.amount_placeholder": "Amount",
        "movement.income": "Income",
        "movement.expense": "Expense",
        "movement.save_button": "Save",
        "achievements.back": "← Back",
        "achievements.title": "Achievements",
        "achievements.system_title": "Achievements System",
        "achievements.subtitle": "Your progress in financial management",
        "achievements.table_achievement": "Achievement",
        "achievements.table_status": "Status",
        "achievements.save_100": "Save 100€",
        "achievements.save_500": "Save 500€",
        "achievements.record_10": "Record 10 movements",
        "achievements.record_50": "Record 50 movements",
        "achievements.first_expense": "First expense recorded",
        "achievements.first_income": "First income recorded",
        "achievements.save_1000": "Save 1000€",
        "achievements.food_under_50": "Food spending < 50€ in a month",
        "achievements.three_months_saving": "3 consecutive months of saving",
        "achievements.export_csv": "Export your history to CSV",
        "achievements.pending": "Pending",
        "achievements.overall_progress": "Overall Progress",
        "achievements.reset_button": "Reset Achievements",
        "market.open_panel": "Open Market panel",
        "market.title": "Live Prices",
        "market.symbols_placeholder": "Symbols (comma-separated), e.g. AAPL,MSFT,SPY",
        "market.subscribe_button": "Subscribe",
        "market.unsubscribe_all": "Unsubscribe all",
        "common.close": "Close"
    }
};

let currentLang = localStorage.getItem("lang") || "es";

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem("lang", lang);
    translatePage();

    // Actualizar la bienvenida si existe la función
    if (typeof mostrarBienvenida === 'function') {
        mostrarBienvenida();
    }
}

function translatePage() {
    // TRADUCE SIEMPRE - sin condiciones restrictivas
    document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (translations[currentLang][key]) {
            el.textContent = translations[currentLang][key];
        }
    });

    document.querySelectorAll("option[data-i18n]").forEach(option => {
        const key = option.getAttribute("data-i18n");
        if (translations[currentLang][key]) {
            option.textContent = translations[currentLang][key];
        }
    });

    // Traducir placeholders
    document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
        const key = el.getAttribute("data-i18n-placeholder");
        if (translations[currentLang][key]) {
            el.placeholder = translations[currentLang][key];
        }
    });

    // Traducir titles
    document.querySelectorAll("[data-i18n-title]").forEach(el => {
        const key = el.getAttribute("data-i18n-title");
        if (translations[currentLang][key]) {
            el.title = translations[currentLang][key];
        }
    });

    // Traducir aria-labels
    document.querySelectorAll("[data-i18n-aria-label]").forEach(el => {
        const key = el.getAttribute("data-i18n-aria-label");
        if (translations[currentLang][key]) {
            el.setAttribute("aria-label", translations[currentLang][key]);
        }
    });
}

let currentCurrency = localStorage.getItem("currency") || "EUR";

function formatCurrency(amount) {
    const symbols = { EUR: "€", USD: "$", GBP: "£" };
    return `${symbols[currentCurrency]}${Number(amount).toFixed(2)}`;
}

function setCurrency(cur) {
    currentCurrency = cur;
    localStorage.setItem("currency", cur);
    if (typeof verHistorial === 'function') {
        verHistorial();
    }
}

// Cargar cuando la página esté lista
document.addEventListener("DOMContentLoaded", function() {
    // Configurar selectores de idioma y moneda
    const langSelect = document.getElementById("langSelect");
    const currencySelect = document.getElementById("currencySelect");

    if (langSelect) {
        langSelect.value = currentLang;
        langSelect.addEventListener("change", (e) => {
            setLanguage(e.target.value);
        });
    }

    if (currencySelect) {
        currencySelect.value = currentCurrency;
        currencySelect.addEventListener("change", (e) => {
            setCurrency(e.target.value);
        });
    }

    // TRADUCIR SIEMPRE - sin condiciones
    translatePage();
});

// También traducir cuando se cambie el idioma dinámicamente
window.addEventListener('storage', function(e) {
    if (e.key === 'lang') {
        currentLang = e.newValue;
        translatePage();
    }
});
